// define variables that reference elements on our page
const choiceForm = document.forms[0];
const choiceInput = choiceForm.elements["choice"];
const resultsList = document.getElementById("results");


let dbresults;
//dummy hardcoded data
let dbresults_dummy ={
  temp_year:2030,
  temp_value:30.26
};

// event-handler functions
function displayValueResult(temp_value,classifier){
  console.log("Displaying a result including just a temperature value");
  console.log(temp_value,classifier);
  // append to the html document
  let newListItem=document.createElement("li");
  newListItem.innerText="The "+classifier+" temperature was "+temp_value.toString();
  resultsList.appendChild(newListItem);
}

function displayYearValueResult(temp_year,temp_value,classifier){
  console.log("Displaying a result including the year and a temperature value");
  console.log(temp_year, temp_value,classifier);
  // append to the html document
  let newListItem=document.createElement("li");
  newListItem.innerText="The "+classifier+" temperature was "+temp_value.toString();
  newListItem.innerText+=" and this happened in "+temp_year.toString();
  resultsList.appendChild(newListItem);
}

function displayMaxData(){
  console.log("Display Maximum Temperature function");
  // parse our response to convert JSON
  dbresults = JSON.parse(this.responseText);
  //iterate through the results
  dbresults.forEach(function(row){
    displayYearValueResult(row['temp_year'],row['temp_value'],"maximum");
  }); 
}


function displayMinData(){
  console.log("Display Minimum Temperature function");
  // parse our response to convert JSON
  dbresults = JSON.parse(this.responseText);
  //iterate through the results
  dbresults.forEach(function(row){
    displayYearValueResult(row['temp_year'],row['temp_value'],"minimum");
  }); 
}


function displayAvgData(){
  console.log("Display average Temperature function");
  // parse our response to convert JSON
  dbresults = JSON.parse(this.responseText);
  //iterate through the results
  dbresults.forEach(function(row){
    displayValueResult(row['temp_value'],"average");
  }); 
}

function displayAllData(){
  console.log("Display all the Temperatures function");
  // parse our response to convert JSON
  dbresults = JSON.parse(this.responseText);
  //iterate through the results
  dbresults.forEach(function(row){
    displayYearValueResult(row['temp_year'],row['temp_value'],"");
  }); 
}

// handler functions
function getMaxTemperature(){
  console.log("Maximum Temperature handler function");
  //request the data from the database
  let requestMsg = new XMLHttpRequest();
  requestMsg.addEventListener("load",displayMaxData);
  requestMsg.open('get', '/getMaxTemperature');
  requestMsg.send();
};

function getMinTemperature(){
  console.log("Minimum Temperature handler function")
  //request the data from the database
  let requestMsg = new XMLHttpRequest();
  requestMsg.addEventListener("load",displayMinData);
  requestMsg.open('get', '/getMinTemperature');
  requestMsg.send();
};

function getAvgTemperature(){
  console.log("Average Temperature handler function")
  //request the data from the database
  let requestMsg = new XMLHttpRequest();
  requestMsg.addEventListener("load",displayAvgData);
  requestMsg.open('get', '/getAvgTemperature');
  requestMsg.send();
};

function getAllTemperature(){
  console.log("All Temperature handler function")
  //request the data from the database
  let requestMsg = new XMLHttpRequest();
  requestMsg.addEventListener("load",displayAllData);
  requestMsg.open('get', '/getAllTemperature');
  requestMsg.send();
};


//listener function
// listen for the form to be submitted
choiceForm.onsubmit = event => {
  // stop our form submission from refreshing the page
  event.preventDefault(); 
  // reset the results section ready for current results
  resultsList.innerHTML = "";
  
  // Call the appropriate handler function
  if (choiceInput.value=="maxTemp"){
    getMaxTemperature();
  } else if (choiceInput.value=="minTemp"){
    getMinTemperature();
  } else if (choiceInput.value=="avgTemp"){
    getAvgTemperature();
  } else {
    getAllTemperature()
  };
  
  //reset form ready for a future choice
  choiceInput.value="";
};
